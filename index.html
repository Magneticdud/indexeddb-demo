<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<title>Title Goes Here</title>
		<script type="text/javascript">
			//global variable for indexedDB support
			var idbSupported = false;
			var db;
			//check for indexedDB 
			//if supported, indexedDBOk return true
			function indexedDBOk() {
				return "indexedDB" in window;
			}
			document.addEventListener("DOMContentLoaded", function(){
				//if no support, exits from this function
				if(!indexedDBOk) return;

					// parameter1: db name, 2: version number
					// need to increase the version number each time there's a need to update the db structure
					var openRequest = indexedDB.open("test",2);
					openRequest.onupgradeneeded = function(e) {
						console.log("Upgrading...");
						var thisDB = e.target.result;
						//if it doesn't contain the key, it creates a new one
						if(!thisDB.objectStoreNames.contains("objectstore1")) {
							thisDB.createObjectStore("objectstore1");
						}
					}
					openRequest.onsuccess = function(e) {
						console.log("Success!");
						db = e.target.result;
						//Listen for add clicks
						document.getElementById("addButton").addEventListener("click", addPerson, false);
						document.getElementById("addButton").disabled=false;
					}
					openRequest.onerror = function(e) {
						console.log("Error");
						console.dir(e);
					}
					
			},false);
			
			function addPerson(e) {
				var name = document.getElementById("name").value;
				var email = document.getElementById("email").value;
			 
				console.log("Adding "+name+"/"+email);
			 
				var transaction = db.transaction(["objectstore1"],"readwrite");
				var store = transaction.objectStore("objectstore1");
			 
				//Define a person
				var person = {
					name:name,
					email:email,
					created:new Date()
				}
			 
				//Perform the add
				var request = store.add(person,1);
			 
				request.onerror = function(e) {
					console.log("Error",e.target.error.name);
					//some type of error handler
				}
			 
				request.onsuccess = function(e) {
					console.log("Element added");
				}
			}
		</script>
	</head>
	<body>
		<p>Please write your name</p>
		<input type="text" id="name" placeholder="Name"><br/>
		<input type="email" id="email" placeholder="Email"><br/>
		<button id="addButton" disabled=true>Add Name</button>
	</body>
</html>



